<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clicker Game</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #141e30, #243b55);
  color: white;
}

.header {
  height: 60px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  font-weight: bold;
}

.container {
  display: flex;
  height: calc(100vh - 60px);
}

.left {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 18px;
}

.stats {
  text-align: center;
  font-size: 18px;
}

.clicker-wrapper {
  position: relative;
}

.clicker {
  width: 260px;
  cursor: pointer;
  transition: transform 0.1s;
}

.clicker:active {
  transform: scale(0.92);
}

.floating {
  position: absolute;
  color: gold;
  font-weight: bold;
  animation: floatUp 1s forwards;
  pointer-events: none;
}

@keyframes floatUp {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-50px); }
}

.right {
  width: 400px;
  background: white;
  color: #222;
  padding: 20px;
  overflow-y: auto;
}

.upgrade {
  background: white;
  border-radius: 16px;
  padding: 15px;
  margin-bottom: 18px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.upgrade.equipped {
  outline: 3px solid gold;
}

.upgrade img.main {
  width: 80px;
}

button {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.buy {
  background: #4CAF50;
  color: white;
}

.buy:disabled {
  background: #aaa;
}

.equip {
  background: #2196F3;
  color: white;
}
</style>
</head>

<body>

<div class="header">ðŸ”¥ My Clicker Game</div>

<div class="container">

  <div class="left">
    <div class="stats">
      Clicks: <span id="clicks">0</span><br>
      CPS: <span id="cps">0</span>
    </div>

    <div class="clicker-wrapper" id="clickerWrapper">
      <img id="mainClicker" class="clicker" src="YIcheng_4.png">
    </div>
  </div>

  <div class="right">
    <h2>Upgrades</h2>
    <div id="upgrades"></div>
  </div>

</div>

<script>
/* =======================
   CORE GAME STATE
======================= */

let _clicks = 0;
let equippedClicker = "YIcheng_4.png";

const upgrades = [
  { name:"Failure", cps:1, cost:50, scale:1.3, count:0, img:"Yicheng_2.png" },
  { name:"Forehead", cps:10, cost:500, scale:1.35, count:0, img:"Wenyao_2.png" },
  { name:"Grade 3 Pianist", cps:50, cost:2500, scale:1.4, count:0, img:"Wenyao.png" },
  { name:"Entrepreneur", cps:250, cost:10000, scale:1.45, count:0, img:"Yicheng_3.png" },
  { name:"Ascended to Heaven", cps:999, cost:50000, scale:1.5, count:0, img:"Yicheng.png" }
];

/* =======================
   HARD RESET (NUKE)
======================= */

function HARD_RESET() {
  console.clear();
  console.warn("Invalid state detected. Resetting.");

  _clicks = 0;
  equippedClicker = "YIcheng_4.png";

  upgrades.forEach(u => {
    u.count = 0;
    u.cost = Math.floor(u.cost / u.scale);
  });

  localStorage.clear();
  sessionStorage.clear();

  updateUI();
}

/* =======================
   PROTECTED CLICKS
======================= */

Object.defineProperty(window, "clicks", {
  get() {
    return _clicks;
  },
  set(v) {
    const diff = Math.abs(v - _clicks);
    if (diff > getCPS() + 25) {
      HARD_RESET();
    } else {
      _clicks = v;
    }
  }
});

/* =======================
   HELPERS
======================= */

function format(n) {
  if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
  if (n >= 1e3) return (n/1e3).toFixed(1) + "K";
  return Math.floor(n);
}

function getCPS() {
  return upgrades.reduce((s,u)=>s + u.count * u.cps, 0);
}

/* =======================
   CLICKING
======================= */

const clicker = document.getElementById("mainClicker");

clicker.onclick = () => {
  clicks += 1;
  spawnFloat("+1");
  updateUI();
};

function spawnFloat(text) {
  const span = document.createElement("span");
  span.className = "floating";
  span.textContent = text;
  span.style.left = Math.random()*120 + "px";
  document.getElementById("clickerWrapper").appendChild(span);
  setTimeout(()=>span.remove(),1000);
}

/* =======================
   UPGRADES
======================= */

function buy(i) {
  const u = upgrades[i];
  if (clicks >= u.cost) {
    clicks -= u.cost;
    u.count++;
    u.cost = Math.floor(u.cost * u.scale);
    updateUI();
  }
}

function equip(i) {
  equippedClicker = upgrades[i].img;
  clicker.src = equippedClicker;
  updateUI();
}

/* =======================
   RENDER
======================= */

const upgradesDiv = document.getElementById("upgrades");

function renderUpgrades() {
  upgradesDiv.innerHTML = "";
  upgrades.forEach((u,i)=>{
    const div = document.createElement("div");
    div.className = "upgrade" + (equippedClicker === u.img ? " equipped" : "");

    div.innerHTML = `
      <img src="${u.img}" class="main">
      <h3>${u.name}</h3>
      <p>+${u.cps} CPS</p>
      <p>Owned: ${u.count}</p>
      <button class="buy" onclick="buy(${i})" ${clicks < u.cost ? "disabled" : ""}>
        Buy (${format(u.cost)})
      </button>
      ${u.count > 0 ? `<button class="equip" onclick="equip(${i})">Equip</button>` : ""}
    `;
    upgradesDiv.appendChild(div);
  });
}

function updateUI() {
  document.getElementById("clicks").textContent = format(clicks);
  document.getElementById("cps").textContent = format(getCPS());
  renderUpgrades();
}

/* =======================
   IMPOSSIBLE JUMP DETECTOR
======================= */

let lastClicks = 0;
let lastTime = Date.now();

setInterval(() => {
  const now = Date.now();
  const elapsed = (now - lastTime) / 1000;

  const maxGain = getCPS() * elapsed + 15;
  const actualGain = clicks - lastClicks;

  if (actualGain > maxGain + 1) {
    HARD_RESET();
  }

  lastClicks = clicks;
  lastTime = now;
}, 250);

/* =======================
   CPS TICK
======================= */

setInterval(() => {
  clicks += getCPS();
  updateUI();
}, 1000);

updateUI();
</script>

</body>
</html>

